
define temp v0
define temp2 v1
define temp3 v2
define temp4 v3

define head_x 	v4
define head_y	v5
define dire v6
define score v7
define food_x v8
define food_y v9
define head va
define tail vb
define find_food vc
define tail_x vd
define tail_y ve


game_start:
                ld      temp3,  8
		ld	head_x,	22
		ld	head_y, 16
		ld 	tail_x,	20
		ld	tail_y,	16
		ld	dire,	4
		ld      temp,   %11100000
                ld      I   ,   #C9F
                ld      [I] ,   v0
                drw     tail_x,tail_y,1
		
		
		ld	I, 	#DA0
		ld 	v0, 	tail_x
		ld	v1,	21
		ld	v2,	22
		ld	[I],	v2

		
		ld	I,	#CA0
		ld	v0,	16
		ld	v1,	16
		ld	v2,	16
		ld	[I],	v2
		
		
		ld	tail,	0
		ld	head,	2
		ld	find_food,	0
		ld 	score,	0

loop:	
                call	key_input
		call	move
		call	check_sur
		call	update_snake
		ld	find_food,	0	
		jp	loop
		


key_input:	
		ld	temp2,	0
		sknp	temp2
		ld	temp,	0
		
		ld	temp2,	8
		sknp	temp2
		ld	temp,	8

		ld	temp2,	12
		sknp 	temp2
		ld 	temp,	12
		
		ld 	temp2, 	4
		sknp	temp2
		ld	temp,	4
		
		
		add	temp, 	8
		ld 	temp2, 	15
		and	temp,	temp2
		se	temp,	dire
		sub 	temp, 	temp3
		ld	dire,	temp

		ret	

move:		
                ld      temp4,  1
		sne	dire,	0
		add	head_y,	1

		sne	dire,	8
		sub	head_y,	temp4
		
		sne 	dire,	12
		sub	head_x,	temp4
		
		sne	dire, 	4
		add	head_x,	1
		

check_sur:	
		sne	head_x,	#ff		
		jp	game_over		
		sne 	head_x,	64		
		jp	game_over
		sne	head_y,	#ff
		jp	game_over
		sne	head_y,	32		
		jp	game_over
		
		
		drw	20,	16,	1	
		se	vf,	1		
		ret
		
		se	head_x,	food_x
		jp	game_over
		se	head_y,	food_y
		jp	game_over
		
		add	score,	1
		ld	temp,	2
		ld	st,	temp
		jp	new_food
		drw	head_x,	head_y,	1	
		ld	find_food,	1	
		ret

new_food:	
		rnd	food_x,	#3F
		rnd	food_y,	#1F

		ld	temp,	63		
		sub	temp,	food_x
		sne	vf,	1
		jp	new_food
		ld	temp,	31
		sub	temp,	food_y
		sne	vf,	1
		jp	new_food

		drw	food_x,	food_y,	1
		sne 	vf,	1
		drw	food_x,	food_y,	1
		sne	vf,	1
		jp	new_food
		ret

update_snake:	
		add	head,	1
		ld	I,	#DA0
		add	I,	head
		ld	temp,	head_x
		ld	[I],	v0
		ld	I,	#CA0
		add	I,	head
		ld	temp,	head_y
		ld	[I],	v0


		se	find_food,	1	
		ret
		ld	I,	#DA0		
		add	I,	tail
		ld 	v0,	[I]
		ld	v1,	v0
		ld	I,	#CA0
		add	I,	tail
		ld	v0,	[I]
		drw	v1,	v0,	1
		add	tail,	1

game_over:	
		ld	v0,	15
		ld	st,	v0
		
		jp game_start


